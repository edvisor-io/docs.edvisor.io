# School API Guide

Detailed explanation and examples to using Edvisor Api as a School

## Web Quotes Engine

Blah blah blah

## Query a list of your web quotes

The `schoolQuoteList` query returns a list of the quotes that students or agents have made via the web-quotes engine. The quotes will always include some basic student information. If an agent made the quote on behalf of a student, then the quote will additionally contain some information about the agency.

To see the full schema for this and other queries, use the [graphql playground](#graphql-playground).

## Including student data

> Query to fetch a list including student data

```graphql
query {
  schoolQuoteList {
    data {
      studentFirstName
      studentLastName
      studentEmail
      studentAge

      studentNationality {
        code
        nameTranslation(languageCode: EN)
      }
    }
  }
}
```

Regardless of whether the quote was generated by a student or an agent on behalf of a student, there will be a minimum amount of student data available, such as an email address and nationality. When querying the nationality remember to include the languageCode if you want to view the country name in another language.

 - [Country](http://docs.edvisor.io/schema/country.doc.html)

<p>
<button
  id='query-student-data-curl'
  class='copy-curl' 
  onclick='copyCURL("query-student-data-curl")' 
  data-curl="curl 'https://api.edvisor.io/graphql' -H 'Accept-Encoding: gzip, deflate, br' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'Connection: keep-alive' -H 'DNT: 1' -H 'authorization: Bearer &lt;YOUR_API_KEY&gt;' --data-binary '{&quot;query&quot;:&quot;query studentInfo {\n  schoolQuoteList {\n    data {\n      studentFirstName\n      studentLastName\n      studentEmail\n      studentAge\n\n      studentNationality {\n        code\n        nameTranslation(languageCode: EN)\n      }\n    }\n  }\n}\n\n&quot;}' --compressed"
>Copy cURL</button>

<button 
  onclick='toggleHidden("query-student-data-json")'
>JSON output</button>

<span id="query-student-data-json" class="center-column hidden">
// example json output
{
  "data": {
    "schoolQuoteList": {
      "data": [
        {
          "studentFirstName": "Robert",
          "studentLastName": "Jones",
          "studentEmail": "rob.jones@email.com",
          "studentAge": 18,
          "studentNationality": {
            "code": "ca",
            "nameTranslation": "Canada"
          }
        }
      ]
    }
  }
}
</span>
</p>

## Including agency information

> Query to fetch a list of quotes including agency information

```graphql
query {
  schoolQuoteList {
    data {
      agencyName
      agencyEmail

      agencyLocationCountry {
        code
        nameTranslation(languageCode: EN)
      }

      agencyRecruitsFromCountries {
        code
        nameTranslation(languageCode: EN)
      }  
    }
  }
}
```

<p>
If the quote was created by an agent, then they will have been asked to include some additional information about their agency such as an email address at which they can be contacted.

<button
  id='query-agency-information-curl'
  class='copy-curl' 
  onclick='copyCURL("query-agency-information-curl")' 
  data-curl="curl 'https://api.edvisor.io/graphql' -H 'Accept-Encoding: gzip, deflate, br' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'Connection: keep-alive' -H 'DNT: 1' -H 'authorization: Bearer &lt;YOUR_API_KEY&gt;' --data-binary '{&quot;query&quot;:&quot;\n\nquery agencyInfo {\n  schoolQuoteList {\n    data {\n      agencyName\n      agencyEmail\n\n      agencyLocationCountry {\n        code\n        nameTranslation(languageCode: EN)\n      }\n\n      agencyRecruitsFromCountries {\n        code\n        nameTranslation(languageCode: EN)\n      }  \n    }\n  }\n}&quot;}' --compressed";
>Copy cURL</button>

<button 
  onclick='toggleHidden("query-agency-information-json")'
>JSON output</button>

<span id="query-agency-information-json" class="center-column hidden">
// example json output
{
  "data": {
    "schoolQuoteList": {
      "data": [
        {
          "agencyName": "Waterfront Agency",
          "agencyEmail": "robert@edvisor.io",
          "agencyLocationCountry": {
            "code": "mx",
            "nameTranslation": "Canada"
          },
          "agencyRecruitsFromCountries": [
            {
              "code": "mx",
              "nameTranslation": "Canada"
            }
          ]
        }
      ]
    }
  }
}
</span>
</p>

## Including Pricing Information

> Query to fetch a list of quotes including pricing info

```graphql
query {
  schoolQuoteList {
    data {
      totalPriceAmount
      currency {
        code
        oneUsd
      }
      quotablePrices {
        ... on CoursePriceItem {
          offering {
            name
          }
          originalPriceAmount
          priceAmount
        }
        ... on AccommodationPriceItem {
          offering {
            name
          }
          originalPriceAmount
          priceAmount
        }
        ... on ServicePriceItem {
          offering {
            name
          }
          serviceQuantity
          originalPriceAmountTimesQuantity
          priceAmountTimesQuantity
        }
      }
    }
  }
}
```

Web quotes are saved with all of the pricing information necessary to render them on the front-end or create an accurate invoice. When querying for the pricing information you will generally need to query the `totalPriceAmount` to show the total, and the `quotablePrices` to show the line items.

The `originalPriceAmount` and `priceAmount` represent the line item price before and after promotions have been applied. The `currency` field contains information about the currency that the quote was made in.

The `quotablePrices` are a graphql union type. This is because the information associated with different kinds of line items is different. For example, `servicePriceItems` have a `serviceQuantity` field. There are three kinds of `quotablePrice` which you can see in the code listing to the right. The `... on Name` syntax is graphql's way of differentiating between the fields available in the elements of the union.

In addition to the offering name and price information, the `QuotePriceItem` is a robust object with many relations. You can use this object to get a more detailed breakdown of the price, including individual fees and discounts, as well as information about the line item such as duration, amount, and start date. Since the `QuotePriceItem` has access to the offering, you can also drill down into the offering to get all kinds of additional information. It is recommended that you experiment with the graphiql explorer to familiarize yourself with the schema.

 - [Currency](http://docs.edvisor.io/schema/currency.doc.html)
 - [CoursePriceItem](http://docs.edvisor.io/schema/coursepriceitem.doc.html)
 - [AccommodationPriceItem](http://docs.edvisor.io/schema/accommodationpriceitem.doc.html)
 - [ServicePriceItem](http://docs.edvisor.io/schema/servicepriceitem.doc.html)
 - [Offering](http://docs.edvisor.io/schema/offering.doc.html)

<p>
<button
  id='query-pricing-information-curl'
  class='copy-curl' 
  onclick='copyCURL("query-pricing-information-curl")' 
  data-curl="curl 'https://api.edvisor.io/graphql' -H 'Accept-Encoding: gzip, deflate, br' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'Connection: keep-alive' -H 'DNT: 1' -H 'authorization: Bearer &lt;YOUR_API_KEY&gt;' --data-binary '{&quot;query&quot;:&quot;query pricingInfo {\n  schoolQuoteList {\n    data {\n      totalPriceAmount\n      currency {\n        code\n        oneUsd\n      }\n      quotablePrices {\n        ... on CoursePriceItem {\n          offering {\n            name\n          }\n          originalPriceAmount\n          priceAmount\n        }\n        ... on AccommodationPriceItem {\n          offering {\n            name\n          }\n          originalPriceAmount\n          priceAmount\n        }\n      }\n    }\n  }\n}\n&quot;}' --compressed"
>Copy cURL</button>

<button 
  onclick='toggleHidden("query-pricing-information-json")'
>JSON output</button>

<span 
 id='query-pricing-information-json' 
 class='center-column hidden'
>
// example json output
{
  "data": {
    "schoolQuoteList": {
      "data": [
        {
          "totalPriceAmount": 2670,
          "currency": {
            "code": "USD",
            "oneUsd": 1
          },
          "quotablePrices": [
            {
              "offering": {
                "name": "Weekly Tutoring"
              },
              "originalPriceAmount": 1000,
              "priceAmount": 750
            },
            {
              "offering": {
                "name": "Homestay"
              },
              "originalPriceAmount": 1920,
              "priceAmount": 1920
            }
          ]
        }
      ]
    }
  }
}
</span>
</p>

## Pagination & Filters

> Query that includes the pagination and filter objects

```graphql
query {
  schoolQuoteList(pagination: {
    limit: 3,
    offset:0
  }, filter:{
    schoolIds:[21],
    orderBy:studentLastName,
    orderDir:asc
  }) {
    data {
      studentLastName
      studentEmail
      
      school {
        schoolId
        name
      }
    }
  }
}
```

The `schoolQuoteList` query supports pagination and filters to control which quotes and how many are returned.

### Pagination

The pagination object accepts a limit, which determines how many results will be returned per page, and an offset which is the index of the first result that you wish to show.

### Filters

At the time of this writing the filter object accepts a list of schoolIds and also accepts a property to order the results by.

 - [School](http://docs.edvisor.io/schema/school.doc.html)

<p>
<button
  id='query-pagination-curl'
  class='copy-curl' 
  onclick='copyCURL("query-pagination-curl")' 
  data-curl="curl 'https://api.edvisor.io/graphql' -H 'Accept-Encoding: gzip, deflate, br' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'Connection: keep-alive' -H 'DNT: 1' -H 'authorization: Bearer &lt;YOUR_API_KEY&gt;' --data-binary '{&quot;query&quot;:&quot;query agencyInfo {\n  schoolQuoteList(pagination: {\n    limit: 3,\n    offset:0\n  }, filter:{\n    schoolIds:[21],\n    orderBy:studentLastName,\n    orderDir:asc\n  }) {\n    data {\n      studentLastName\n      studentEmail\n      \n      school {\n        schoolId\n        name\n      }\n    }\n  }\n}\n&quot;}' --compressed"
>Copy cURL</button>

<button 
  onclick='toggleHidden("query-pagination-json")'
>JSON output</button>

<span 
 id='query-pagination-json' 
 class='center-column hidden'
>
// example json output
{
  "data": {
    "schoolQuoteList": {
      "data": [
        {
          "studentLastName": "Byrne",
          "studentEmail": "byrne@email.com",
          "school": {
            "schoolId": 21,
            "name": "School 5 Campus A [TEST]"
          }
        },
        {
          "studentLastName": "Roberts",
          "studentEmail": "roberts@email.com",
          "school": {
            "schoolId": 21,
            "name": "School 5 Campus A [TEST]"
          }
        },
        {
          "studentLastName": "Wilfred",
          "studentEmail": "wilfred@email.com",
          "school": {
            "schoolId": 21,
            "name": "School 5 Campus A [TEST]"
          }
        }
      ]
    }
  }
}
</span>
</p>

## Query a specific web quote by id

> Query a singe school quote by it's unique id

```graphql
query {
  schoolQuote(schoolQuoteId: 11) {
    schoolQuoteId
    studentLastName
    studentEmail

    school {
      schoolId
      name
    }
  }
}
```

Once you have used the list query to get a list of quotes you can use the `schoolQuote` query to get just one quote by id. Thus together the two endpoints can be used to create a listing page and a view page, for example.

To see the full schema for this and other queries, use the [graphql playground](#graphql-playground).

<p>
<button
  id='query-school-quote-curl'
  class='copy-curl' 
  onclick='copyCURL("query-school-quote-curl")' 
  data-curl="curl 'https://api.edvisor.io/graphql' -H 'Accept-Encoding: gzip, deflate, br' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'Connection: keep-alive' -H 'DNT: 1' -H 'authorization: Bearer &lt;YOUR_API_KEY&gt;' --data-binary '{&quot;query&quot;:&quot;\n\nquery get {\n  schoolQuote(schoolQuoteId: 11) {\n    schoolQuoteId\n    studentLastName\n    studentEmail\n\n    school {\n      schoolId\n      name\n    }\n  }\n}\n&quot;}' --compressed"
>Copy cURL</button>

<button 
  onclick='toggleHidden("query-school-quote-json")'
>JSON output</button>

<span 
 id='query-school-quote-json' 
 class='center-column hidden'
>
// example json output
{
  "data": {
    "schoolQuote": {
      "schoolQuoteId": 11,
      "studentLastName": "Chen",
      "studentEmail": "",
      "school": {
        "schoolId": 21,
        "name": "School 5 Campus A [TEST]"
      }
    }
  }
}
</span>
</p>

<script>
  function copyCURL (id) {
    const button = document.getElementById(id);
    const curl = button.dataset.curl

    const textArea = document.createElement("textarea");
    textArea.value = curl;
    document.body.appendChild(textArea);

    textArea.select();
    document.execCommand('copy');

    document.body.removeChild(textArea);
  }

  function toggleHidden (id) {
    const el = document.getElementById(id)

    el.classList.contains('hidden')
      ? el.classList.remove('hidden')
      : el.classList.add('hidden')
  }
</script>